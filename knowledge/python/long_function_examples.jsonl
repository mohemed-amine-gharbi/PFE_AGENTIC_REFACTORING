{"type":"long_function_example","language":"python","title":"split_validation_and_transform","smell":"long_function_mixed_stages","before":"def create_profile(payload, db):\n    if 'email' not in payload:\n        raise ValueError('email required')\n    if 'name' not in payload:\n        raise ValueError('name required')\n    email = payload['email'].strip().lower()\n    name = payload['name'].strip()\n    user = db.create_user(email=email, name=name)\n    return {'id': user.id, 'email': user.email, 'name': user.name}","after":"def _validate_profile_payload(payload):\n    if 'email' not in payload:\n        raise ValueError('email required')\n    if 'name' not in payload:\n        raise ValueError('name required')\n\n\ndef _normalize_profile_payload(payload):\n    return payload['email'].strip().lower(), payload['name'].strip()\n\n\ndef _profile_response(user):\n    return {'id': user.id, 'email': user.email, 'name': user.name}\n\n\ndef create_profile(payload, db):\n    _validate_profile_payload(payload)\n    email, name = _normalize_profile_payload(payload)\n    user = db.create_user(email=email, name=name)\n    return _profile_response(user)","notes":"Long function split into validation/normalization/formatting while preserving API."}
{"type":"long_function_example","language":"python","title":"extract_side_effect_block","smell":"long_function_with_logging_and_persistence","before":"def submit_order(order, db, logger):\n    if not order.get('items'):\n        raise ValueError('items required')\n    total = sum(item['price'] for item in order['items'])\n    record = db.save_order(order, total)\n    logger.info(f'order {record.id} saved')\n    return {'id': record.id, 'total': total}","after":"def _validate_order(order):\n    if not order.get('items'):\n        raise ValueError('items required')\n\n\ndef _calculate_total(order):\n    return sum(item['price'] for item in order['items'])\n\n\ndef _save_order(order, total, db, logger):\n    record = db.save_order(order, total)\n    logger.info(f'order {record.id} saved')\n    return record\n\n\ndef submit_order(order, db, logger):\n    _validate_order(order)\n    total = _calculate_total(order)\n    record = _save_order(order, total, db, logger)\n    return {'id': record.id, 'total': total}","notes":"Extracts coherent phases and preserves DB/log order."}
{"type":"long_function_example","language":"python","title":"keep_public_signature_unchanged","smell":"long_public_function","before":"def sync_users(users, api, logger):\n    results = []\n    for user in users:\n        if not user.get('email'):\n            logger.warning('missing email')\n            continue\n        payload = {'email': user['email'].strip().lower(), 'name': user.get('name', '').strip()}\n        response = api.push_user(payload)\n        results.append({'email': payload['email'], 'status': response['status']})\n    return results","after":"def _build_user_payload(user):\n    return {'email': user['email'].strip().lower(), 'name': user.get('name', '').strip()}\n\n\ndef _result_row(payload, response):\n    return {'email': payload['email'], 'status': response['status']}\n\n\ndef sync_users(users, api, logger):\n    results = []\n    for user in users:\n        if not user.get('email'):\n            logger.warning('missing email')\n            continue\n        payload = _build_user_payload(user)\n        response = api.push_user(payload)\n        results.append(_result_row(payload, response))\n    return results","notes":"Function remains public and same signature; helper extraction reduces length/readability burden."}
