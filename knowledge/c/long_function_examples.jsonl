{"id":"c_long_001","language":"c","agent":"LongFunctionAgent","before":"int process_order(OrderRequest *req){ if(req==NULL) return ERR_NULL; if(req->count==0) return ERR_EMPTY; Customer *c = find_customer(req->customer_id); if(c==NULL) return ERR_CUSTOMER; int total=0; for(size_t i=0;i<req->count;i++){ total += req->items[i].price * req->items[i].qty; } Order o; o.customer=c; o.total=total; if(save_order(&o)!=0) return ERR_SAVE; audit_order_created(o.total); return OK; }","after":"static int validate_request(OrderRequest *req){ if (req == NULL) return ERR_NULL; if (req->count == 0) return ERR_EMPTY; return OK; } static int calculate_total(const OrderRequest *req){ int total = 0; for (size_t i = 0; i < req->count; ++i) { total += req->items[i].price * req->items[i].qty; } return total; } int process_order(OrderRequest *req){ int status = validate_request(req); if (status != OK) return status; Customer *customer = find_customer(req->customer_id); if (customer == NULL) return ERR_CUSTOMER; int total = calculate_total(req); Order order; order.customer = customer; order.total = total; if (save_order(&order) != 0) return ERR_SAVE; audit_order_created(order.total); return OK; }","why_safe":"Validation, lookup, total computation, save, and audit order preserved; logic split into helpers only."}
