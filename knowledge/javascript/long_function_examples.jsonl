{"id":"js_long_001","language":"javascript","agent":"LongFunctionAgent","before":"async function submitOrder(req){ if(!req) throw new Error('missing'); if(!req.items || req.items.length===0) throw new Error('empty'); const user = await findUser(req.userId); if(!user) throw new Error('user'); let total = 0; for(const item of req.items){ total += item.price * item.qty; } const order = { userId:user.id, total }; await saveOrder(order); await audit('order_created', order); return order; }","after":"function validateOrderRequest(req){ if(!req) throw new Error('missing'); if(!req.items || req.items.length===0) throw new Error('empty'); } function computeTotal(items){ let total = 0; for (const item of items) { total += item.price * item.qty; } return total; } async function submitOrder(req){ validateOrderRequest(req); const user = await findUser(req.userId); if(!user) throw new Error('user'); const total = computeTotal(req.items); const order = { userId:user.id, total }; await saveOrder(order); await audit('order_created', order); return order; }","why_safe":"Validation, user lookup, total computation, save and audit order preserved; function split into helpers only."}
