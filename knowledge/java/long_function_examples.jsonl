{"id":"java_long_001","language":"java","agent":"LongFunctionAgent","before":"public Response process(OrderRequest req){ if(req==null) throw new IllegalArgumentException(); if(req.getItems()==null||req.getItems().isEmpty()) return Response.error(\"empty\"); Customer c = customerRepo.find(req.getCustomerId()); if(c==null) return Response.error(\"customer\"); BigDecimal total = BigDecimal.ZERO; for(Item i:req.getItems()){ total = total.add(i.getPrice().multiply(BigDecimal.valueOf(i.getQty()))); } Order o = new Order(); o.setCustomer(c); o.setTotal(total); orderRepo.save(o); audit(\"order_created\", o.getId()); return Response.ok(o.getId()); }","after":"public Response process(OrderRequest req){ validateRequest(req); if (isEmptyRequest(req)) return Response.error(\"empty\"); Customer customer = loadCustomer(req); if (customer == null) return Response.error(\"customer\"); BigDecimal total = calculateTotal(req); Order order = buildOrder(customer, total); orderRepo.save(order); audit(\"order_created\", order.getId()); return Response.ok(order.getId()); } private void validateRequest(OrderRequest req){ if (req == null) throw new IllegalArgumentException(); } private boolean isEmptyRequest(OrderRequest req){ return req.getItems() == null || req.getItems().isEmpty(); } private Customer loadCustomer(OrderRequest req){ return customerRepo.find(req.getCustomerId()); } private BigDecimal calculateTotal(OrderRequest req){ BigDecimal total = BigDecimal.ZERO; for (Item i : req.getItems()) { total = total.add(i.getPrice().multiply(BigDecimal.valueOf(i.getQty()))); } return total; } private Order buildOrder(Customer customer, BigDecimal total){ Order order = new Order(); order.setCustomer(customer); order.setTotal(total); return order; }","why_safe":"Validation, DB lookup, total calculation, save, audit, and response order preserved; logic extracted into helpers only."}
